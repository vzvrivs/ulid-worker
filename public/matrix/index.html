<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ðŸ§¬ ULID Matrix</title>

  <script>
    const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
    document.documentElement.setAttribute("data-theme", prefersDark ? "dark" : "light");
  </script>

  <link rel="stylesheet" href="/style.css">
</head>

<body>

  <header id="nav-container" class="header-nav-container"></header>

  <main class="page-wrapper">

    <canvas id="matrix"></canvas>

  </main>

  <footer>ULID Playground â€¢ CodÃ© avec ðŸ’š par RaphaÃ«l et ðŸ¤– â€¢ Licence MIT</footer>

  <script type="module">
  import { ulid, decodeTime } from "/module/ulid";

  const canvas = document.getElementById("matrix");
  const ctx = canvas.getContext("2d");

  function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  window.addEventListener("resize", resize);
  resize();

  const chars = "0123456789ABCDEFGHJKMNPQRSTVWXYZ";
  const fontSize = 16;
  let columns = Math.floor(window.innerWidth / fontSize);
  let drops = Array(columns).fill(1);

  function getThemeColor() {
    const styles = getComputedStyle(document.documentElement);
    let color = styles.getPropertyValue('--text').trim();
    if (!color) color = "#33ff33"; // SÃ©curitÃ© â†’ couleur par dÃ©faut
    return color;
  }

  function draw() {
    ctx.fillStyle = getComputedStyle(document.documentElement)
                      .getPropertyValue("--matrix-overlay")
                      .trim();

    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = getThemeColor();
    ctx.font = fontSize + "px monospace";

    for (let i = 0; i < drops.length; i++) {
      const char = chars[Math.floor(Math.random() * chars.length)];
      ctx.fillText(char, i * fontSize, drops[i] * fontSize);

      if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
        drops[i] = 0;
      }
      drops[i]++;
    }
  }

  setInterval(draw, 40);

  // ULID secret â†’ touche M
  document.addEventListener("keydown", (e) => {
    if (e.key === "m" || e.key === "M") {
      const id = ulid();
      const unix = decodeTime(id);
      const iso = new Date(unix).toISOString();

      document.getElementById("ulid-reveal").textContent = id;
      document.getElementById("ts-unix").textContent = unix + " ms";
      document.getElementById("ts-iso").textContent = iso;

      document.getElementById("secret").style.display = "block";
    }
    if (e.key === "/") {
      window.location.href = "/";
    }
  });

  // Mise Ã  jour des colonnes si resize
  window.addEventListener("resize", () => {
    columns = Math.floor(window.innerWidth / fontSize);
    drops = Array(columns).fill(1);
  });

  </script>

  <script type="module" src="./site.js"></script>

</body>
</html>
